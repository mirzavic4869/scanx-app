import { Button } from '@/components/button'
import { CardScan } from '@/components/card'
import { Input } from '@/components/input'
import { BruteForceModal } from '@/components/modal'
import axios from 'axios'
import React, { useEffect, useState } from 'react'
import Swal from 'sweetalert2'
import { useRouter } from 'next/router'
import { deleteCookie, getCookie } from 'cookies-next'
import { baseURL } from '@/components/lib'

export default function BruteForce() {
  const router = useRouter()
  const value = [
    {
      id: '1',
      title: 'Command Line',
      url: '/exploitation-tools',
    },
    {
      id: '2',
      title: 'Pishing',
      url: 'http://phis.scanx.my.id/',
    },
    {
      id: '3',
      title: 'Brute Force',
      url: '/exploitation-tools/brute-force',
    },
  ]
  const session = getCookie('session')
  const [searchResult, setSearchResult] = useState([])
  const [taskID, setTaskID] = useState('')
  const [isOpen, setIsOpen] = useState(false)
  const [scanResult, setScanResult] = useState([])

  const handleSubmit = (e) => {
    e.preventDefault()
    toSearch(taskID)
  }

  useEffect(() => {
    setTaskID(scanResult)
  }, [scanResult])

  async function toSearch(taskID) {
    try {
      const payload = taskID
      const result = await axios({
        method: 'GET',
        url: `${baseURL}/wpscanbruteforcescan?task_id=${payload}`,
        headers: {
          Authorization: `Bearer ${session}`,
          'Content-Type': 'application/json',
        },
      })
      setSearchResult(result.data)
      setTaskID('')
    } catch (error) {
      await Swal.fire('Sorry', 'Data harus diisi!', 'error')
    }
  }
  return (
    <div className="flex flex-col">
      <div className="mb-4 flex items-center justify-between">
        <h1 className="mb-5 text-lg font-semibold md:text-2xl">Brute Force</h1>
        <Button onClick={() => setIsOpen(!isOpen)}>NEW SCAN</Button>
      </div>
      <div className="mb-4 flex flex-row justify-between gap-4">
        <Input
          onChange={(e) => setInput(e.target.value)}
          name="task_id"
          placeholder="Task ID"
          value={taskID}
        />
        <Button onClick={handleSubmit}>Search</Button>
      </div>
      <div className="grid gap-4 md:grid-cols-4 lg:grid-cols-6">
        <CardScan title="Scanning Tools" value={value} />
        <div
          className={`flex flex-col rounded ${
            searchResult.length < 1 ? '' : 'h-fit'
          } bg-white p-4 shadow-sm hover:shadow-md md:col-span-3 lg:col-span-5`}
        >
          <h1 className="mb-6 text-lg font-semibold">Result</h1>
          <p>{searchResult}</p>
        </div>
      </div>
      {/* Modal */}
      <BruteForceModal
        isOpen={isOpen}
        onClose={() => setIsOpen(false)}
        scanResult={scanResult}
        setScanResult={setScanResult}
      />
    </div>
  )
}
